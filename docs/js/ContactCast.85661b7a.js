(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["ContactCast"],{b0c0:function(t,e,a){var n=a("83ab"),s=a("9bf2").f,i=Function.prototype,c=i.toString,o=/^\s*function ([^ (]*)/,r="name";n&&!(r in i)&&s(i,r,{configurable:!0,get:function(){try{return c.call(this).match(o)[1]}catch(t){return""}}})},dd0c:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Header"),n("div",{staticClass:"container"},[n("SideBar"),n("main",[n("section",{staticClass:"contact-cast-section"},[n("h2",[t._v("コンタクト")]),n("div",{staticClass:"contact-box"},["cast"!==t.roll?n("section",{staticClass:"contact-cast"},[n("paginate",{staticClass:"paginate",attrs:{name:"paginate-log",list:t.logs,per:10,tag:"div"}},t._l(t.paginated("paginate-log"),(function(e,s){return n("article",{key:s,staticClass:"cast-box"},[n("router-link",{staticClass:"cast-link-box",attrs:{to:"/cast/detail/"+e.accountId+"/1",tag:"div"}},[n("div",{staticClass:"img-box"},[e.imgurl?n("img",{attrs:{src:e.imgurl,alt:"キャストの画像"}}):n("img",{attrs:{src:a("5ec8"),alt:"キャストの画像"}})]),n("div",{staticClass:"cast-info"},[n("div",{staticClass:"cast-name-info"},[n("p",{staticClass:"cast-name"},[t._v(t._s(e.name?t.nameLimit(e.name):t.nameLimit("未設定")))])]),n("div",{staticClass:"category"},t._l(e.category,(function(e,a){return n("p",{key:a,staticClass:"cast-category"},[t._v(t._s(e||"未設定"))])})),0),n("div",{staticClass:"sns-icon"},[n("span",{class:{active:t.isInstagramActive}},[n("i",{staticClass:"fab fa-instagram"})]),n("span",{class:{active:t.isTwitterActive}},[n("i",{staticClass:"fab fa-twitter active"})]),n("span",{class:{active:t.isYouTubeActive}},[n("i",{staticClass:"fab fa-youtube"})]),n("span",{class:{active:t.isTikTokActive}},[n("i",{staticClass:"fab fa-tiktok"})])]),"admin"===t.roll?n("div",{staticClass:"inquiry"},[n("p",{staticClass:"email"},[t._v(t._s(e.email?e.email:"未設定"))]),n("p",{staticClass:"tell"},[t._v(t._s(e.tell?e.tell:"未設定"))])]):t._e()])]),n("div",{staticClass:"message-btn"},[n("div",{on:{click:function(a){return t.openModal(e.accountId,e.userId)}}},[t._v("チャット")]),"client"!==t.roll||e.complete?t._e():n("div",{directives:[{name:"show",rawName:"v-show",value:t.isHidden,expression:"isHidden"}],on:{click:function(a){return t.CompleteOpenModal(e.userId)}}},[t._v("取引完了")])])],1)})),0),n("paginate-links",{attrs:{for:"paginate-log",limit:3,"show-step-links":!0,classes:{ul:"pagination",li:"pagination-list","li > a":"pagination-link"}}})],1):t._e(),"cast"===t.roll?n("article",{staticClass:"client-box"},[n("router-link",{staticClass:"client-link-box",attrs:{to:"/client/detail/"+t.clientData.accountId,tag:"div"}},[n("div",{staticClass:"img-box"},[t.clientData.imgurl?n("img",{attrs:{src:t.clientData.imgurl,alt:"クライアントの画像"}}):n("img",{attrs:{src:a("5ec8"),alt:"クライアントの画像"}})]),n("div",{staticClass:"client-info"},[n("div",{staticClass:"client-name-info"},[n("p",{staticClass:"client-name"},[t._v(t._s(t.clientData.client?t.nameLimit(t.clientData.client):t.nameLimit("未設定")))])]),n("div",{staticClass:"category"},t._l(t.clientData.category,(function(e,a){return n("p",{key:a,staticClass:"client-category"},[t._v(t._s(e||"未設定"))])})),0),n("div",{staticClass:"inquiry"},[n("p",{staticClass:"email"},[t._v(t._s(t.clientData.email?t.clientData.email:"未設定"))]),n("p",{staticClass:"tell"},[t._v(t._s(t.clientData.tell?t.clientData.tell:"未設定"))])])])]),n("div",{staticClass:"message-btn"},[n("div",{on:{click:function(e){return t.openModal(t.clientData.myAccountId,t.clientData.myUid)}}},[t._v("チャット")])])],1):t._e(),n("section",{directives:[{name:"show",rawName:"v-show",value:t.showModal,expression:"showModal"}],staticClass:"overlay-box",on:{click:t.closeModal}},[n("div",{staticClass:"message-box",on:{click:t.stopEvent}},[n("div",{class:[{helfwidth:"admin"===t.roll},"name"]},["client"!==t.roll?n("div",[n("p",[t._v(t._s(t.clientName?t.clientName:"未設定"))])]):t._e(),"cast"!==t.roll?n("div",[n("p",[t._v(t._s(t.castName?t.castName:"未設定"))])]):t._e()]),n("div",{staticClass:"message"},["cast"===t.roll||"admin"===t.roll?n("div",t._l(t.messages,(function(e,a){return n("div",{key:a,class:[{clientmessage:!e.position},"castmessage"]},[n("p",[t._v(t._s(e.coment))])])})),0):t._e(),"client"===t.roll?n("div",t._l(t.messages,(function(e,a){return n("div",{key:a,class:[{clientmessage:e.position},"castmessage"]},[n("p",[t._v(t._s(e.coment))])])})),0):t._e()]),"admin"!==t.roll&&t.complete?n("div",{staticClass:"input-box"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.inputMessage,expression:"inputMessage"}],attrs:{rows:"2"},domProps:{value:t.inputMessage},on:{input:function(e){e.target.composing||(t.inputMessage=e.target.value)}}}),n("i",{staticClass:"fas fa-share",on:{click:t.saveMessage}})]):t._e()])]),n("section",{directives:[{name:"show",rawName:"v-show",value:t.alertModal,expression:"alertModal"}],staticClass:"overlay-box",on:{click:t.closeModal}},[n("div",{staticClass:"alert-box",on:{click:t.stopEvent}},[n("p",[t._v("取引を完了してもいいですか？")]),n("small",[t._v("※これ以上の連絡はできなくなります")]),n("br"),n("small",[t._v("※キャストへの報酬が発生します")]),n("div",{staticClass:"btn-box"},[n("div",{on:{click:t.closeModal}},[t._v("キャンセル")]),n("div",{on:{click:t.transactionComplete}},[t._v("取引完了")])])])])])])])],1)],1)},s=[],i=(a("4160"),a("b0c0"),a("a9e3"),a("159b"),a("96cf"),a("1da1")),c=a("0418"),o=a("7c08"),r=a("4ee7"),l={components:{Header:c["a"],SideBar:o["a"]},data:function(){return{roll:localStorage.roll,doc:"",clientUid:"",campaignId:"",castId:"",castUid:"",clientName:"",castName:"",inputMessage:"",clientData:{},messages:[],logs:[],paginate:["paginate-log"],showModal:!1,alertModal:!1,complete:!0,isHidden:!0,isInstagramActive:!1,isTwitterActive:!1,isYouTubeActive:!1,isTikTokActive:!1}},created:function(){var t=this;this.campaignId=this.$route.params["id"],this.clientUid=this.$route.query.uid;var e=r["a"].firestore().collection("account"),a=r["a"].firestore().collection("campaigns"),n=r["a"].auth().currentUser.uid,s=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.where("campaignid","==",t.campaignId).get();case 2:n=e.sent,t.doc=n.docs[0].id;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c=function(){var a=Object(i["a"])(regeneratorRuntime.mark((function a(){var s,i,c,o,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return s=[],a.next=3,e.where("userId","==",n).get();case 3:return i=a.sent,a.next=6,e.where("userId","==",t.clientUid).get();case 6:return c=a.sent,o=i.docs[0].data(),r=c.docs[0].data(),s.push({myData:o,clientData:r}),a.abrupt("return",s);case 11:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),o=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(a){var s,i,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(s=a[0].myData,i=a[0].clientData,""===i.imgpath){e.next=8;break}return c=i.imgpath,e.next=6,r["a"].storage().ref().child(c).getDownloadURL().then((function(e){i.imgurl=e,i.myAccountId=s.accountId,i.myUid=n,t.clientData=i}));case 6:e.next=11;break;case 8:i.myAccountId=s.accountId,i.myUid=n,t.clientData=i;case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=[],e.next=3,a.doc(t.doc).collection("applys").where("status","==",!0).get();case 3:return s=e.sent,t.campaignId=s.docs[0].data().campaignId,s.forEach((function(t){n.push(t.data())})),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=function(){var t=Object(i["a"])(regeneratorRuntime.mark((function t(a){var n,s,i,c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=[],s=0;case 2:if(!(s<a.length)){t.next=12;break}return t.next=5,e.where("userId","==",a[s].uid).get();case 5:i=t.sent,c=i.docs[0].data(),c.complete=a.complete,n.push(c);case 9:s++,t.next=2;break;case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(a){var n,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<a.length)){e.next=16;break}if(d(a[n]),""===a[n].imgpath){e.next=12;break}return s=a[n].imgpath,e.next=7,r["a"].storage().ref().child(s).getDownloadURL();case 7:i=e.sent,a[n].imgurl=i,t.logs.push(a[n]),e.next=13;break;case 12:t.logs.push(a[n]);case 13:n++,e.next=1;break;case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d=function(e){""===e.myInstagram.accountId&&""===e.myInstagram.accountName&&""===e.myInstagram.accountType&&""===e.myInstagram.followerCount&&""===e.myInstagram.goodAverage&&""===e.myInstagram.engagement||(t.isInstagramActive=!0),""===e.myTwitter.accountId&&""===e.myTwitter.accountName&&""===e.myTwitter.accountType&&""===e.myTwitter.followerCount&&""===e.myTwitter.goodAverage&&""===e.myTwitter.engagement||(t.isTwitterActive=!0),""===e.myYouTube.accountId&&""===e.myYouTube.accountName&&""===e.myYouTube.accountType&&""===e.myYouTube.followerCount&&""===e.myYouTube.goodAverage&&""===e.myYouTube.engagement||(t.isYouTubeActive=!0),""===e.myTikTok.accountId&&""===e.myTikTok.accountName&&""===e.myTikTok.accountType&&""===e.myTikTok.followerCount&&""===e.myTikTok.goodAverage&&""===e.myTikTok.engagement||(t.isTikTokActive=!0)},p=function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var a,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:if("cast"!==t.roll){e.next=10;break}return e.next=5,c();case 5:return a=e.sent,e.next=8,o(a);case 8:e.next=18;break;case 10:return e.next=12,l();case 12:return n=e.sent,e.next=15,u(n);case 15:return i=e.sent,e.next=18,m(i);case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();p()},methods:{nameLimit:function(t){var e=18;return t.length>e?t.substr(0,e)+"...":t},openModal:function(t,e){var a=this;this.castId=t,console.log(t),console.log(e),this.showModal=!0;var n=r["a"].firestore().collection("account"),s=r["a"].firestore().collection("campaigns"),i=r["a"].firestore().collection("message");console.log(this.doc),s.doc(this.doc).collection("applys").doc(e).get().then((function(t){!0===t.data().complete&&(a.complete=!1)})),n.where("accountId","==",this.castId).get().then((function(t){a.castName=t.docs[0].data().name})),n.where("userId","==",this.clientUid).get().then((function(t){a.clientName=t.docs[0].data().client})),i.doc(this.campaignId+this.castId).get().then((function(t){a.messages=t.data().message}))},CompleteOpenModal:function(t){this.castUid=t,this.alertModal=!0},closeModal:function(){this.showModal=!1,this.alertModal=!1},stopEvent:function(t){t.stopPropagation()},saveMessage:function(){var t=this,e=r["a"].firestore().collection("message"),a=this.campaignId+this.castId,n=[];0===this.messages.length?("client"===this.roll?n.push({campaignId:this.campaignId,coment:this.inputMessage,position:!0,date:new Date}):"cast"===this.roll&&n.push({campaignId:this.campaignId,coment:this.inputMessage,position:!1,date:new Date}),e.doc(a).set({message:n}).then((function(){t.inputMessage="",t.messages=n}))):e.doc(a).get().then((function(s){n=s.data().message,"client"===t.roll?n.push({campaignId:t.campaignId,coment:t.inputMessage,position:!0,date:new Date}):"cast"===t.roll&&n.push({campaignId:t.campaignId,coment:t.inputMessage,position:!1,date:new Date}),e.doc(a).update({message:n}).then((function(){t.inputMessage="",t.messages=n}))}))},transactionComplete:function(){var t=this,e=r["a"].firestore().collection("campaigns");e.doc(this.doc).collection("applys").doc(this.castUid).update({complete:!0,completeTime:new Date}).then((function(){t.isHidden=!1,e.doc(t.doc).collection("applys").where("status","==",!0).get().then((function(a){if(a.size>0){var n=0;a.forEach((function(t){!0===t.data().complete&&(n+=1)})),t.logs.length===n&&e.doc(t.doc).update({complete:!0,completeDate:new Date})}}))})),e.where("campaignid","==",this.campaignId).get().then((function(a){var n=a.docs[0].data(),s=n.payment;e.doc(t.doc).update({payment:Number(s)+Number(n.price)}).then((function(){t.closeModal()}))}))}}},u=l,m=a("2877"),d=Object(m["a"])(u,n,s,!1,null,null,null);e["default"]=d.exports}}]);
//# sourceMappingURL=ContactCast.85661b7a.js.map